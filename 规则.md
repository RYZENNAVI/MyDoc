# SQL 任务编写与审查规则（根据导师反馈整理）

本规则依据 2025 年 5 月导师多次反馈内容整理，适用于 Sedrila 项目中 SQL 任务的设计与审查，尤其是 `sql-*` 系列任务。

---

## ✅ 任务设计与整体结构

1. **统一命名规范**  
   遵循 Sedrila 命名规则：https://sedrila.readthedocs.io/en/latest/authors/#114-naming-conventions  
   - 任务文件名必须小写开头，用 `sql-` 前缀；  
   - SQL 关键词使用全大写；  
   - 用连字符连接各部分，如：`sql-UPDATE-VIEW`。

2. **整体规划任务组（taskgroup）**  
   任务需成体系，考虑前置任务（assumes）与所需任务（required）的完整性。

3. **前置任务未提交时，勿提交后续任务**  
   所依赖的 `assumed` 和 `required` 任务需已提交或审核。

---

## 📘 任务文档结构与表达方式

4. **[BACKGROUND::...] 仅用于动机**  
   不可用于介绍 SQL 概念，概念应写在任务步骤开始部分。

5. **目标分类准确**  
   - 教学性任务：使用 `goal::idea` 或 `goal::experience`；  
   - 产出型任务：使用 `goal::product`。

6. **避免过多标题层级**  
   使用三级标题 `###` 即可，防止任务显得混乱。

7. **命令性语句不得作标题**  
   如 `### 执行以下 SQL 代码` 应改为具意义的描述，如 `### 示例：UPDATE 操作演示`

8. **上下文明确**  
   每个段落或代码块需说明其目的，避免读者迷失上下文。

---

## 📖 示例与文档引用

9. **提供权威参考来源**  
    - `difficulty=1`: 给出明确位置或指引；  
    - `difficulty=2`: 可稍模糊，但需有提示；  
    - `difficulty=3`: 允许宽泛，但仍需说明如何找到资料。  
    - **推荐 SQL 教程站点**（按综合质量与可读性排序，供任务中引用）：  
      1. [SQLTutorial.org](https://www.sqltutorial.org) – 体系完整，章节目录清晰，示例基于多种数据库；  
      2. [W3Schools SQL Tutorial](https://www.w3schools.com/sql/) – 入门友好，交互式示例；  
      3. [SQLBolt](https://sqlbolt.com) – 逐步练习式教程，适合动手实践；  
      4. [Mode Analytics SQL Tutorial](https://mode.com/sql-tutorial/) – 可在线执行查询，案例贴近数据分析。

10. **文档引用语气明确**  
    不用“可以阅读”，而应说“建议/需要阅读以完成任务”。

11. **示例需与任务目标关联**  
    示例代码不应孤立，需说明其教学作用和后续关联。

---

## ⚠️ 内容准确性与教学引导

12. **避免含混描述**  
    如“今天”应指明是静态日期还是动态表达式 `today()`，并说明其语法来源。

13. **与任务难度对应的引导强度**  
    - `difficulty=2`：需适当引导，不能跳跃过大；  
    - 若涉及知识点未在前面讲过，应提供阅读参考。

14. **清理无用 INCLUDE 语句**  
    不再使用的 `[INCLUDE::...]` 应彻底移除，避免冗余。

---

## 🧩 开发协作与维护规范

15. **任务改名需同步 Issue 标题**  
    避免命名不一致带来困扰。

16. **沟通中使用标记编号（T1, T2, ...）**  
    回应反馈、提出问题时统一使用，方便逐点对齐。

17. **合理使用工具，并说明优劣**  
    - SQLite Online 简便但缺乏历史记录；  
    - 本地 `sqlite3` 专业但略复杂；  
    - 可混合使用，但需明确说明理由与推荐用法。

18. **推荐工具需说明其可用性与操作方法**  
    如 `sqlite3` 命令行工具，需说明版本限制（仅 3.12+）及如何使用。

19. **拆分无关联内容至新任务**  
    如涉及进阶概念或研究性问题，应另建任务说明。

20. **提交修改时简洁回应即可**  
    若根据建议做了调整，可简要列出已实施的点，并在 commit 中标明相关 Issue 编号（如 #1）。无需撰写冗长回复；若引入了新内容或想法，可适当补充说明。

21. **将示例解决方案移至私有分支**  
    标准答案（如 Musterlösung）不应直接出现在公开可见的任务源码中，而应存放在私有仓库（如 altdir 分支）中。在任务文件中只保留 INCLUDE 引用语句即可。

---

## 🧱 根据 T1–T13 总结的任务设计规范（新增）（SQL-Basics 经验）

22. **明确解释关系型数据库及其基础结构（T1）**  
    若无法预设学习者已有知识，应在任务开头介绍 rDBMS 的基本概念，如表（Table）、主键（Primary Key）、外键（Foreign Key）、Schema（模式）等。

23. **任务应提及 Schema 的作用（T2）**  
    任务中涉及 `ALTER TABLE` 或 `CREATE TABLE` 操作时，应提供 Schema 的定义及其背景理解，帮助学生建立表结构的整体认识。

24. **SQLite 明确为教学参考系统（T3）**  
    任务需声明当前使用的是 SQLite 数据库，并指出其他系统（如 PostgreSQL、MySQL）在 SQL 支持和语法上的可能差异，避免误解。

25. **给出明确的 SQLite 阅读引导（T4）**  
    文档引用不应模糊，应具体指出阅读目标与范围，例如：  
    > “请阅读 SQLite 文档第 2.1 节，以理解 `CREATE TABLE` 的字段声明规则。”

26. **任务难度应反映所含概念复杂度（T5）**  
    如果任务包含多个 SQL 操作或涉及数据建模概念，应设置为 `difficulty: 2` 或更高，确保任务在认知负荷上与等级匹配。

27. **宏结构语法需符合格式规范（T6）**  
    任务文件中的 `[NOTICE]`、`[ENDNOTICE]` 等结构性宏，需**各自占一行**，不得嵌入段落或混写在正文中，以确保格式一致性。

28. **使用明确的变量名替代元字符（T7）**  
    避免直接使用 `<tablename>` 等抽象占位符，应使用如 `mytable`、`mycolumn` 等具体且具有教学意义的变量名。

29. **避免链接到未引入的复杂概念（T8）**  
    在基础任务中，不应直接链接涉及外键、复合约束等进阶 SQL 概念的页面，除非前文已有清楚介绍或引导。

30. **引用应说明阅读深度与目标（T9）**  
    所有外部链接都应附带用途说明，例如：  
    > “此链接用于辅助理解 `INSERT` 中的默认值机制。”

31. **所有术语需解释清楚（T10）**  
    例如 `NULL`、`PRIMARY KEY`、`CONSTRAINT` 不应直接引入，而应在首次使用时附带简洁解释。

32. **核心概念需显式强调（T11）**  
    如 `PRIMARY KEY` 不应仅作为注释或隐含说明，而应在文档结构中明确突出，可使用 `[EQ]`、强调句或列表呈现。

33. **INSERT 操作需说明必填字段（T12）**  
    应明确指出哪些字段必须提供值，何时可以省略或使用默认值、`NULL`，并说明背后的逻辑。

34. **SELECT 示例应结合 WHERE 引导（T13）**  
    不应将 `SELECT` 和 `WHERE` 分开讲解，应配合示例说明条件过滤语句的基本语义和使用逻辑。

35. **提交前务必预览渲染结果（T14–T17 总览）**  
    在合并或关闭 Issue 之前，必须打开任务的 **渲染视图**（HTML 或 GitHub 预览）检查排版，确保不存在裸露的 Markdown 标记、列表错位等可视化问题。

36. **避免三重反引号裸露于 HTML（T14）**  
    - 代码围栏必须成对出现：开头 `\`\`\`` 与结尾 `\`\`\`` 数量及类型一致；  
    - 若需在说明中展示反引号本身，可使用转义 `\`\`` 或 HTML 实体 `&#96;`。  
    - 渲染视图中如出现 ``` 块，请立即修正围栏或缩进。

37. **确保列表正确换行与缩进（T15）**  
    - 列表项之间需保留空行，避免渲染成单段落；  
    - 子列表需四个空格或一个制表符缩进；  
    - 过长行可手动换行并对齐缩进，保证阅读体验。

38. **所有程序文本均需使用反引号包裹（T16）**  
    - 行内代码使用单反引号 `` `code` ``；  
    - 多行示例使用语言标记的代码围栏，如 ````sql ... ````；  
    - 任何 SQL 关键字、命令或文件路径第一次出现时，若只作引用亦应使用反引号。

39. **明确 [EQ] 标记用途并避免误用（T17）**  
    `[EQ]`（Explanatory Quote）用于强调**核心概念解释**，例如 PRIMARY KEY 的作用或 NULL 的语义。请遵循：  
    - 仅在需额外突出说明的教学要点前使用 `[EQ]`；  
    - 在正文中紧随概念或示例之后给出解释，保持上下文连贯；  
    - 若导师未要求，不要随意新增 `[EQ]`，以免削弱其强调效果。

40. **JOIN 示例应使用区分度高的列名（JOIN-1）**  
    - 为避免示例显得“自我连接”，左右表应使用不同列名（如 `column4` vs. `column1`）；  
    - 推荐用具有业务含义的名称（如 `fk`, `customer_id`），帮助学生理解外键关系。

41. **指明 SQLite 对 JOIN 的限制并给出替代方案（JOIN-2）**  
    - 在涉及 `RIGHT JOIN`, `FULL JOIN` 的任务中，须写明 SQLite 原生不支持；  
    - 提供 `LEFT JOIN` 表交换或 `UNION`/`UNION ALL` 方式模拟，附示例代码。

42. **对 ID 连续性等假设需加 [NOTICE]（JOIN-3）**  
    若示例或任务假设 `courses.id` 从 1 开始连续增长，必须写 `[NOTICE]` 说明该假设非 SQL 保证，避免误导学习者。

43. **提示（[HINT]）应针对关键决策点（JOIN-4）**  
    - 与其泛泛提示 “如何连接表”，更应引导学生判断在何种数据条件下选择 `INNER/LEFT JOIN`；  
    - 删除或替换脱离上下文的旧提示，保持与当前任务一致。

44. **说明 UNION 与 UNION ALL 的差异（JOIN-5）**  
    - 在用 `UNION` 模拟 `FULL JOIN` 时注明：`UNION` 默认去重；  
    - 若需要保留重复行，应明确提示使用 `UNION ALL`。

---
45. **行长度不超100字符**  


> ✅ 建议在每次任务编写或审核时，将本规则清单作为对照标准，并持续更新补充。
